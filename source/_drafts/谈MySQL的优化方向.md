---
title: 简谈 MySQL 的优化方向
date: 2017-03-01 11:43:05
tags:
- MySQL
- 数据库
- 优化
---
## 前言
数据库优化，一个永远也逃不开、躲不掉的问题，这本应该是从项目设计之前就应该纳入考虑的问题，可由于成本、资源、时间限制，大多项目在开始之初可能根本没考虑过这个问题。现在市场上多如牛毛的项目，活下来是第一原则，而你项目的完成进度很可能就是项目能否活下来的一个关键因素。

在方方面面的条件制约下，一部分人甚至根本没有意识到数据库设计这个问题，只是赶进度，设计数据库是也是怎么方便怎么来。部分查询不方便？加字段；字段类型？全部设成varchar；字段长度？varchar(255)。等项目上线了，稍微有一些些规模时候，才发现，这个表的字段太多，那个表的字段类型有点问题，这时候想要再更改已几乎是不太可能。

下面简要说一下从设计到开发阶段整个流程应该注意的一点问题，由于经验限制，下面只是个人的一点点感想，仅供参考，若有不对之处，欢迎指正。

## 设计阶段
### 范式与反范式

### 字段的适当冗余能增加
### 表结构设计
### 表字段设计
    - [概述](http://dev.mysql.com/doc/refman/5.5/en/data-types.html)
      [存储需要](http://dev.mysql.com/doc/refman/5.5/en/storage-requirements.html)
    - 贪婪原则, 但也要考虑拓展性
    - 慎重使用 enum [Why enum is evil](http://komlenic.com/244/8-reasons-why-mysqls-enum-data-type-is-evil/)
    需要使用到 enum 的时候选择Tinyint或Char
        * 举例子 zfix_banner 表的 type

## 使用阶段优化
数据库无外乎CURD四种操作，其中使用最频繁的莫过于查询，大概为10：1

[MySQL索引原理及慢查询优化](http://tech.meituan.com/mysql-index.html)

#### 第一步，弄清瓶颈在哪里

##### 凭感觉
##### 查看日志，找到慢查询

##### 使用Explain命令
MySql命令: [Explain 命令](http://dev.mysql.com/doc/refman/5.5/en/explain-output.html)
./M_explain.md

#### 第二步，常用优化原则

##### 单表优化
改变where顺序，增加索引，简单, 最左匹配原则

##### 多表联合查询优化

##### 使用SQL完成业务（IP查询）

###### 分解查询

* 将复杂的查询分为多步

##### 参数延迟绑定

* 子查询的可读性比联合查询高，联合查询比子查询效率高，如何取舍得看具体的业务应用场景

##### 结合业务场景

总结 对照表

## 常用字段设计对照表
## 查询对照表

抛砖引玉，更复杂的例如事物、触发器、游标、锁希望后台架构来分享

## 参考 
1. 高性能MySQL
2. 官方手册
3. 
